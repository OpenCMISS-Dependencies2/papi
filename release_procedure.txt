Release Procedure for PAPI  Feb 08, 2012

Below is a step-wise procedure for making a PAPI release.
This is a living document and may not be totally current or accurate.
It is an attempt to capture current practice in making a PAPI release.
Please update it as appropriate.

One way to use this procedure is to print a copy and check off
the lines as they are completed to avoid confusion.
================================================================================
__ 1. Notify developers that a release is imminent and the repository should be
	considered frozen.

__ 2. Update any documentation that may have changed. Pay particular attention
	to INSTALL.txt.

__ 3. Check/Change the version number in: papi.spec, papi.h, configure.in, Makefile.in,
	Doxyfile-common (PROJECT_NUMBER) ; and commit to the repo.

-- 3a. On most icl machines:
	export PATH=/mnt/scratch/sw/doxygen-1.7.4/bin:$PATH
	-- or --
	setenv PATH /mnt/scratch/sw/doxygen-1.7.4/bin:$PATH

-- 3b. Rebuild the doxygen manpages (  cd doc && make && make install )
	You will want to check if anything needs to be committed to cvs.
	(Usually the $(papi_dir)/man/man1 and man3 directories)

-- 3c. Update the website docs; 
	We use Doxyfile-html for this, 
	newgrp papi		# changes your defacto group to papi (starts a new shell)
	$(papi_dir)/doc make clean html
	rm -rf /silk/homes/icl/projectsdev/papi/docs/* 
	cp -R doc/html/* /silk/homes/icl/projectsdev/papi/docs;
	chmod -R 755 /silk/homes/icl/projectsdev/papi/docs

__ 4. If configure.in is changed, run autoconf (2.59) and commit the resulting
	configure file.
	NOTE: Using an autoconf version >2.59 will work, but will produce an 
	inordinate number of extraneous differences between versions.

__ 5. Create a ChangeLog for the current release. 
	- One handy way to do this is to use the python script that comes with
	WinCVS:
	  Macros->CVS->Build ChangeLog (advanced).
	Use the -r<branch>: command to log commit messages from the previous 
	branch point to the present.
	- Another is to use the perl script: cvs2cl.pl as follows:
	  > perl ./cvs2cl.pl -F trunk --group-within-date -l "-d>2010/09/30"
	  (where the date is the date of the previous release)

__ 6. Scan the ChangeLog to remove extraneous fluff, like perfctr imports.

__ 7. Modfy RELEASENOTES.txt to summarize the major changes listed in the log.

__ 8. Add ChangeLogXYZ.txt to cvs and commit both ChangeLogXYZ.txt and 
	RELEASENOTES.txt.

__ 9a. Update your local copy from cvs to make sure you have all changes.

__ 9b. Tag cvs: papi-X-Y-Z-t.
      cvs tag papi-X-Y-Z-t

__ 10. If this is not an incremental release, also branch cvs: papi-X-Y-Z-b.
      cvs tag -r papi-X-Y-Z-t -b papi-X-Y-Z-b

__ 11. Export the tag to a clean working directory:
	> cvs export -r <tag> <module> ex:
	> cvs export -r papi-3-7-2-t papi

__ 12. Delete any unneccessary files or directories
		particularly .doc and .pdf files in the /doc directory
	Things needed in /doc {Doxyfile, Doxyfile-everything}
        You can use the delete_before_release.sh script for this.

__ 13. Rename the directory from papi to papi-X.Y.Z

__ 14. tar the directory:
	> tar -cvf papi-X.Y.Z.tar papi-X.Y.Z

__ 15. zip the tarball:
	gzip papi-X.Y.Z.tar

__ 16. Copy the tarball to /silk/homes/icl/projects/papi/downloads

__ 17. Check permissions on the tarball. 664 is good. 

__ 18. Create a link with supporting text on the PAPI software web page.

__ 19. Create a News item on the PAPI Web page.

__ 20. Email the papi developer and discussion lists with an announcement.

__ 21. Post the announcement on the PAPI User Forum.

================================================================================

Patch Procedure for PAPI  January 29, 2010

Below is a step-wise procedure for making a PAPI patch.

One way to use this procedure is to print a copy and check off
the lines as they are completed to avoid confusion.
================================================================================
__ 0. Make sure that the version of cvs that you are using to create the patch is the same 
        as the version used to create the tarball to be patched. Versions before 1.12.9 use
        backslashes in date strings; versions after that use hyphens. The two don't mix!

__ 1. Export the tagged version of PAPI that you want to patch against:
	> cvs export -r <tag> <module> ex:
	> cvs export -r papi-4-0-0-t papi
	Exporting eliminates the cvs directories that will change between versions.

__ 2. Rename the tagged directory:
	mv papi papi400t

__ 3. Export the branch of PAPI that you want to patch with:
	> cvs export -r <branch> <module> ex:
	> cvs export -r papi-4-0-0-b papi

__ 4. Rename the branch directory:
	mv papi papi400b

__ 5. Diff the two directories:
	> diff -rupwBN <original> <new> > <output.diff> ex:
	> diff -rupwBN papi 400t papi400b > papi400patch1.diff
	
	The flags for diff are:
	-r: recursive
	-u: unified
	-p: show function names
	-w: ignore all white space
	-B: ignore changes whose lines are blank
	-N: treat absent files as empty

__ 6. Create a copy of the directory to be patched and cd into it.

__ 7. Apply the patch:
                > patch -p1 ../<patchfile>
                > patch -p1 ../papi400patch3.diff

__ 8. If the patch applied cleanly, build and test on affected platforms;
         otherwise clean up the patch and try again.

__ 9. Copy the diff file to icl:/sw/www/icl/projects/papi/downloads/patches

__ 10. Check permissions on the diff. 644 is good. 

__ 11. Create a link with supporting text on the PAPI software web page.

__ 12. Create a News item on the PAPI Web page.

__ 13. Email the papi discussion list with an announcement.

__ 14. Post the announcement on the PAPI User Forum.




